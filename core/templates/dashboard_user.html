{% extends 'base.html' %}
{% load static %}

{% block title %}Tableau de bord{% endblock %}

{% block content %}

<div class="dashboard">

    <!-- Sidebar -->
    <aside class="sidebar">
        <h2 class="logo">Djan<span>Pay</span></h2>
        <nav>
            <a href="{% url 'dashboard' %}" class="active">ğŸ  Tableau de bord</a>
            <a href="{% url 'account' %}">ğŸ’° Mon Compte</a>
            <a href="{% url 'transfer' %}">ğŸ’¸ Virement</a>
            <a href="{% url 'history' %}">ğŸ“œ Historique</a>
            <a href="{% url 'profile' %}">ğŸ‘¤ Profil</a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <header class="topbar">
            <div>
                <h2>Bienvenue, {{ user.username }}</h2>
                <p class="topbar-subtitle">Tableau de bord financier</p>
            </div>
            <a href="{% url 'logout' %}" class="logout-btn">ğŸšª DÃ©connexion</a>
        </header>

        <!-- Statistiques principales -->
        <section class="stats-section">
            <div class="summary-grid">
                <div class="info-card stat-card balance-card">
                    <div class="stat-icon">ğŸ’°</div>
                    <div class="stat-content">
                        <p class="stat-label">Solde actuel</p>
                        <p class="stat-value">{{ account.balance|floatformat:2 }} â‚¬</p>
                        <p class="stat-trend positive">+2.5% ce mois</p>
                    </div>
                </div>

                <div class="info-card stat-card">
                    <div class="stat-icon">ğŸ“¤</div>
                    <div class="stat-content">
                        <p class="stat-label">Total dÃ©pensÃ©</p>
                        <p class="stat-value debit">{{ total_spent|floatformat:2 }} â‚¬</p>
                        <p class="stat-detail">{{ monthly_count }} transaction(s) ce mois</p>
                    </div>
                </div>

                <div class="info-card stat-card">
                    <div class="stat-icon">ğŸ“¥</div>
                    <div class="stat-content">
                        <p class="stat-label">Total reÃ§u</p>
                        <p class="stat-value credit">{{ total_received|floatformat:2 }} â‚¬</p>
                        <p class="stat-detail">Toutes transactions</p>
                    </div>
                </div>

                <div class="info-card stat-card">
                    <div class="stat-icon">ğŸ“Š</div>
                    <div class="stat-content">
                        <p class="stat-label">Cette semaine</p>
                        <p class="stat-value">{{ weekly_spent|floatformat:2 }} â‚¬</p>
                        <p class="stat-detail">{{ weekly_count }} transaction(s)</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Actions rapides -->
        <section class="quick-actions">
            <h3 class="section-title">Actions rapides</h3>
            <div class="action-grid">
                <a href="{% url 'transfer' %}" class="action-card">
                    <span class="action-icon">ğŸ’¸</span>
                    <span class="action-label">Nouveau virement</span>
                </a>
                <a href="{% url 'history' %}" class="action-card">
                    <span class="action-icon">ğŸ“œ</span>
                    <span class="action-label">Historique</span>
                </a>
                <a href="{% url 'account' %}" class="action-card">
                    <span class="action-icon">ğŸ’³</span>
                    <span class="action-label">Mon compte</span>
                </a>
                <a href="{% url 'profile' %}" class="action-card">
                    <span class="action-icon">ğŸ‘¤</span>
                    <span class="action-label">Profil</span>
                </a>
            </div>
        </section>

        <!-- Graphiques -->
        <section class="charts-section">
            <div class="charts-grid">

                <!-- Graphique Ã©volution mensuelle -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">ğŸ“ˆ Ã‰volution sur 6 mois</h3>
                        <select id="chart1-period" class="chart-select">
                            <option value="6">6 mois</option>
                            <option value="12">12 mois</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="monthlyChart"></canvas>
                    </div>
                </div>

                <!-- Graphique dÃ©penses vs revenus -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">ğŸ’¹ DÃ©penses vs Revenus</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="balanceChart"></canvas>
                    </div>
                </div>

            </div>
        </section>

        <!-- Transactions rÃ©centes + ActivitÃ© -->
        <section class="activity-section">
            <div class="activity-grid">

                <!-- Transactions rÃ©centes -->
                <div class="transactions-card">
                    <div class="card-header">
                        <h3 class="section-title">ğŸ•’ Transactions rÃ©centes</h3>
                        <a href="{% url 'history' %}" class="view-all-link">Voir tout â†’</a>
                    </div>

                    {% if recent_transactions %}
                    <div class="transactions-list">
                        {% for transaction in recent_transactions %}
                        <div class="transaction-item">
                            <div class="transaction-icon">
                                {% if transaction.sender == user %}
                                    <span class="icon-circle debit">ğŸ“¤</span>
                                {% else %}
                                    <span class="icon-circle credit">ğŸ“¥</span>
                                {% endif %}
                            </div>
                            <div class="transaction-info">
                                {% if transaction.sender == user %}
                                    <p class="transaction-name">Vers {{ transaction.receiver.username }}</p>
                                    <p class="transaction-date">{{ transaction.timestamp|date:"d/m/Y Ã  H:i" }}</p>
                                {% else %}
                                    <p class="transaction-name">De {{ transaction.sender.username }}</p>
                                    <p class="transaction-date">{{ transaction.timestamp|date:"d/m/Y Ã  H:i" }}</p>
                                {% endif %}
                            </div>
                            <div class="transaction-amount">
                                {% if transaction.sender == user %}
                                    <span class="amount debit">-{{ transaction.amount|floatformat:2 }} â‚¬</span>
                                {% else %}
                                    <span class="amount credit">+{{ transaction.amount|floatformat:2 }} â‚¬</span>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“­</div>
                        <p class="empty-text">Aucune transaction rÃ©cente</p>
                        <a href="{% url 'transfer' %}" class="btn-primary btn-sm">Effectuer un virement</a>
                    </div>
                    {% endif %}
                </div>

                <!-- Timeline d'activitÃ© -->
                <div class="activity-card">
                    <h3 class="section-title">ğŸ“… ActivitÃ© du mois</h3>

                    <div class="activity-timeline">
                        <div class="timeline-item">
                            <div class="timeline-dot active"></div>
                            <div class="timeline-content">
                                <p class="timeline-title">DÃ©penses ce mois</p>
                                <p class="timeline-amount debit">{{ monthly_spent|floatformat:2 }} â‚¬</p>
                                <p class="timeline-date">{{ monthly_count }} transaction(s)</p>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <p class="timeline-title">Cette semaine</p>
                                <p class="timeline-amount">{{ weekly_spent|floatformat:2 }} â‚¬</p>
                                <p class="timeline-date">{{ weekly_count }} transaction(s)</p>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <p class="timeline-title">Solde moyen</p>
                                <p class="timeline-amount">{{ account.balance|floatformat:2 }} â‚¬</p>
                                <p class="timeline-date">Mise Ã  jour quotidienne</p>
                            </div>
                        </div>
                    </div>

                    <div class="activity-summary">
                        <div class="summary-item">
                            <span class="summary-label">Budget mensuel</span>
                            <span class="summary-value">5 000 â‚¬</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {% widthratio monthly_spent 5000 100 %}%"></div>
                        </div>
                        <p class="progress-text">{{ monthly_spent|floatformat:2 }} â‚¬ / 5 000 â‚¬ ({% widthratio monthly_spent 5000 100 %}%)</p>
                    </div>
                </div>

            </div>
        </section>

        <!-- Footer info -->
        <section class="dashboard-footer">
            <div class="footer-cards">
                <div class="footer-card">
                    <p class="footer-label">Compte actif depuis</p>
                    <p class="footer-value">{{ user.date_joined|date:"d F Y" }}</p>
                </div>
                <div class="footer-card">
                    <p class="footer-label">SÃ©curitÃ©</p>
                    <p class="footer-value">ğŸ”’ ActivÃ©e</p>
                </div>
                <div class="footer-card">
                    <p class="footer-label">Support</p>
                    <p class="footer-value">ğŸ“ 24/7 disponible</p>
                </div>
            </div>
        </section>

    </main>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<!-- Dashboard JS avec donnÃ©es -->
<script>
// DonnÃ©es pour les graphiques (passÃ©es depuis Django)
const monthlyData = {{ monthly_data|safe }};
</script>
<script src="{% static 'js/dashboard.js' %}"></script>

{% endblock %}
